# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/config-gitpod-file)
# and commit this file to your remote git repository to share the goodness with others.

github:
  prebuilds:
    # Only prebuild in master branch
    master: true
    branches: false
    pullRequests: false
    pullRequestsFromForks: false
    addCheck: false
    addComment: false
    addBadge: false
tasks:

  - name: Installing Dependencies
    before: cd oceano-api
    init: |
      echo 'ðŸ“¦ Installing Dependencies'
      npm install && npm run build
      cp .env.example .env
  - name: Docker Setup
    before: cd oceano-api
    command: |
      echo 'ðŸš€ Starting Docker - PostgreSQL - Adminer'
      docker-compose pull
      gp sync-done "docker-up"
      docker-compose up
  - name: Start API Server
    before: cd oceano-api
    init: |
      gp sync-await "docker-up" && sleep 60s
      npx prisma migrate dev
    command: |
      gp sync-await "docker-up" && sleep 5s
      gp sync-done "server-api-up"
      npm run start:dev
  - name: Deep Dive Dashboard
    before: cd deepdive-dashboard
    command: |
      gp sync-await "server-api-up"
      head -n -1 .env.example > temp.env && mv temp.env .env.example
      echo API_URL=$(gp url 3001) >> .env.example
      cp .env.example .env
      npm install && npm run build
      gp preview $(gp url 3001)/swagger --external
      npm run start
ports:
  - port: 8080
    visibility: public
    onOpen: ignore
  - port: 3000
    visibility: public
    onOpen: open-browser
  - port: 3001
    visibility: public
    onOpen: ignore
  - port: 5432
    onOpen: ignore
    
vscode:
  extensions:
    - ms-azuretools.vscode-docker